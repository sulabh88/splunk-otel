# ğŸŒŸ **Dynatrace Code Module Deployment on OpenShift (CSI-less Injection)**

```{=html}
<p align="center">
```
`<img src="https://dt-cdn.net/images/dynatrace-logo-2021-1-1024x512.png" alt="Dynatrace Logo" width="450"/>`{=html}
```{=html}
</p>
```
Dynatrace is an **AI-powered fullâ€‘stack observability platform** that
helps you automatically monitor applications, infrastructure, logs, user
experience, and business insights.\
This guide shows how to integrate Dynatrace **Code Modules / OneAgent**
into your application running on **OpenShift**, using the **CSIâ€‘less
initâ€‘container method**.

------------------------------------------------------------------------

# ğŸ¯ **What Is Dynatrace? (Simple Explanation)**

Dynatrace is like a **24Ã—7 intelligent doctor for your applications and
clusters**.

It automatically: - ğŸ§  **Understands** your app (services, pods, APIs,
databases) - ğŸ” **Tracks performance** (latency, errors, CPU, memory) -
ğŸ“¦ **Monitors infrastructure** (nodes, containers, kubelets, etc.) - ğŸ¤–
**Detects problems automatically** using AI - âš ï¸ **Tells you the root
cause** (not just alerts) - ğŸ“ˆ **Shows dashboards** for everything

Dynatrace uses the **OneAgent**, a small smart software component that
autoâ€‘discovers all running processes and dependencies.

------------------------------------------------------------------------

# âš™ï¸ **How OneAgent Works (Very Simple)**

1.  ğŸ”½ **Init Container Downloads Code Modules**\
    The Dynatrace init container pulls monitoring libraries into a
    shared directory.

2.  ğŸ”— **Your Application Mounts the Libraries**\
    The deployment mounts `/opt/dynatrace` and autoâ€‘loads the agent.

3.  ğŸ§© **OneAgent Instruments Your Process**\
    Without code changes, it injects monitoring into:

    -   Java
    -   Node.js
    -   Python
    -   Go
    -   .NET
    -   Nginx
    -   Apache
    -   And many more

4.  â˜ï¸ **Data Reaches Dynatrace**\
    Metrics, logs, traces, and topology go to the Dynatrace UI.

5.  ğŸ¤– **Davis AI Finds Problems Automatically**\
    Dynatrace explains:

    -   What broke
    -   Where it broke
    -   Why it broke
    -   Who is impacted

------------------------------------------------------------------------

# ğŸ“š **Official Dynatrace References**

  ------------------------------------------------------------------------------------------------------------------
  Topic                               Link
  ----------------------------------- ------------------------------------------------------------------------------
  Dynatrace Documentation             https://docs.dynatrace.com

  Dynatrace OpenShift Operator        https://docs.dynatrace.com/docs/openshift

  Code Modules (CSIâ€‘less)             https://docs.dynatrace.com/docs/oneagent/installation/container/code-modules

  Dynatrace API Reference             https://www.dynatrace.com/support/help/shortlink/api-overview

  Download Tokens                     https://docs.dynatrace.com/docs/oneagent/apis/access-tokens
  ------------------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------

# ğŸš€ **Overview**

Dynatrace supports two injection methods:

  -----------------------------------------------------------------------
  Method                      Description
  --------------------------- -------------------------------------------
  **CSI Driver                Automatic, persistent, no init containers
  (Recommended)**             

  **CSIâ€‘less Init Container   Simple, compatible with any OpenShift
  (this repo)**               cluster
  -----------------------------------------------------------------------

This repository demonstrates the **CSIâ€‘less** approach.

------------------------------------------------------------------------

# ğŸ§± **Prerequisites**

-   OpenShift **4.x**
-   Dynatrace SaaS or Managed
-   API token with:
    -   `InstallerDownload`
    -   `ReadSettings`
-   Working internet/proxy from cluster
-   `oc` CLI

------------------------------------------------------------------------

# ğŸ”‘ **1. Create Dynatrace Secret**

``` bash
oc create secret generic dynatrace-secret \
  --from-literal=apiToken=<YOUR_TOKEN> \
  -n <your-namespace>
```

------------------------------------------------------------------------

# ğŸ“¦ **2. Deploy Application Using Dynatrace Code Modules**

File: `manifests/openshift-nginx-dynatrace.yaml`

``` yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-dynatrace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      initContainers:
      - name: dynatrace-init
        image: registry.connect.redhat.com/dynatrace/oneagent-codemodules:latest
        env:
        - name: ONEAGENT_INSTALLER_SCRIPT_URL
          value: "https://<YOUR_ENV>.live.dynatrace.com/api/v1/deployment/installer/agent/unix/latest?flavor=musl&arch=x86"
        - name: API_TOKEN
          valueFrom:
            secretKeyRef:
              name: dynatrace-secret
              key: apiToken
        volumeMounts:
        - name: dynatrace-config
          mountPath: /mnt/config

      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        volumeMounts:
        - name: dynatrace-config
          mountPath: /opt/dynatrace

      volumes:
      - name: dynatrace-config
        emptyDir: {}
```

Apply:

``` bash
oc apply -f manifests/openshift-nginx-dynatrace.yaml
```

------------------------------------------------------------------------

# ğŸ” **3. Verify Initialization**

``` bash
oc get pod -l app=nginx \
  -o jsonpath='{.items[*].status.initContainerStatuses}'
```

Check injected modules:

``` bash
oc exec -it $(oc get pod -l app=nginx -o name) -- ls -l /opt/dynatrace
```

------------------------------------------------------------------------

# ğŸ“ˆ **4. Validate in Dynatrace UI**

In Dynatrace:

**Applications â†’ Services â†’ Process Groups**

Look for: - âœ” Nginx monitored - âœ” Code Modules active - âœ” No
connectivity issues

------------------------------------------------------------------------

# ğŸ›  **Troubleshooting**

### âš  Init Container Fails

``` bash
oc logs <pod> -c dynatrace-init
```

### âš  `/opt/dynatrace` Empty

Add security context:

``` yaml
securityContext:
  runAsUser: 1001
  fsGroup: 1001
```


``` bash
curl -vk https://<YOUR_ENV>.live.dynatrace.com
```

------------------------------------------------------------------------


